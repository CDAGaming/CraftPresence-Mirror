image: openjdk:17

before_script:
  - export GRADLE_USER_HOME=`pwd`/.gradle

cache:
  key:
    files:
      - gradle/wrapper/gradle-wrapper.properties
  paths:
    - .gradle/wrapper
    - .gradle/caches

build:
  script:
    - ./gradlew --build-cache :fabric:build
  rules:
    - if: $CI_COMMIT_BRANCH == "l10n_master" || $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == "l10n_master"
      when: never
    - if: $CI_COMMIT_BRANCH || $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME
  artifacts:
    paths:
      - fabric/build/libs/*.jar
    expire_in: 1 month

deploy_all:
  script:
    - ./gradlew --build-cache :fabric:build
    - ./gradlew --build-cache :universal:publishToModSites
  artifacts:
    paths:
      - fabric/build/libs/*.jar
    expire_in: 1 month
  when: manual

deploy_curseforge:
  script:
    - ./gradlew --build-cache :fabric:build
    - ./gradlew --build-cache :universal:curseforge
  artifacts:
    paths:
      - fabric/build/libs/*.jar
    expire_in: 1 month
  when: manual

deploy_modrinth:
  script:
    - ./gradlew --build-cache :fabric:build
    - ./gradlew --build-cache :universal:modrinth
  artifacts:
    paths:
      - fabric/build/libs/*.jar
    expire_in: 1 month
  when: manual
